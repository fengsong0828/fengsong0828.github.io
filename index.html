<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LowAltitude Insight | 低空经济洞察</title>
    <!-- 引入外部样式表 -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- 1. 导航栏 Header -->
    <header>
        <div class="standard-container">
            <div class="nav-inner">
                <!-- Logo：点击回首页 -->
                <a href="index.html" class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    LowAltitude<span>Insight</span>
                </a>
                
                <!-- 手机端菜单按钮 -->
                <button class="mobile-menu-btn" onclick="toggleMenu()">☰</button>

                <!-- 导航链接 -->
                <nav class="nav-links" id="navMenu">
                    <a href="index.html" class="active">首页</a>
                    <a href="news.html">资讯快报</a>
                    <a href="policies.html">政策法规</a>
                    <a href="tech.html">技术前沿</a>
                    <a href="companies.html">公司数据库</a>
                </nav>

                <!-- 功能按钮 -->
                <div class="header-actions">
                    <button class="btn btn-outline">搜索</button>
                    <!-- 登录按钮 -->
                    <button class="btn btn-primary" id="auth-btn">订阅/登录</button>
                </div>
            </div>

        </div>
    </header>

    <!-- 2. Hero 区域 -->
    <section class="hero">
        <div class="standard-container">
            <h1>构建低空经济的数字基础设施</h1>
            <p>实时洞察全球 eVTOL、无人机物流及城市空中交通（UAM）的政策、技术与资本动态。</p>
            <a href="products.html" class="btn btn-primary" style="padding: 12px 32px; display:inline-block;">
                浏览全球低空飞行器产品库
            </a>
        </div>
    </section>

    <!-- 3. 核心数据仪表盘 (带动画) -->
    <div class="standard-container">
        <div class="dashboard-grid">
            <a href="chart-funding.html" class="data-card" style="text-decoration: none; color: inherit;">
                <div class="data-label">全球融资总额</div>
                <div class="data-value">$4.2B</div>
                <span class="trend-indicator">▲ 12% 同比增长</span>
            </a>
            <a href="chart-cities.html" class="data-card" style="text-decoration: none; color: inherit;">
                <div class="data-label">试点城市</div>
                <div class="data-value">26</div>
                <span class="trend-indicator">▲ 新增 3 个</span>
            </a>
            <a href="chart-patents.html" class="data-card" style="text-decoration: none; color: inherit;">
                <div class="data-label">本周新增专利</div>
                <div class="data-value">142</div>
                <span class="trend-indicator">主要领域: 电池/飞控</span>
            </a>
            <a href="chart-companies.html" class="data-card" style="text-decoration: none; color: inherit;">
                <div class="data-label">已收录企业</div>
                <div class="data-value">850+</div>
                <span class="trend-indicator">查看全景图谱 →</span>
            </a>
        </div>
    </div>

    <!-- 4. 主内容区域 -->
    <div class="standard-container">
        <div class="main-layout-grid">
            <!-- 左侧：最新动态 -->
            <main class="content-left">
                <div class="section-header">
                    <div class="section-title">最新动态</div>
                    <!-- ★★★ 确认点 1：查看更多跳转 news.html (原代码已正确，保持不变) ★★★ -->
                    <a href="news.html" class="section-link">查看更多 ></a>
                </div>

                <!-- 动态新闻容器 -->
                <div class="news-feed" id="home-news-container">
                    <p style="text-align:center; color:#999; padding:20px;">正在加载最新资讯...</p>
                </div>
            </main>

            <!-- 右侧：侧边栏 -->
            <!-- 右侧：侧边栏 -->
            <aside class="sidebar">
                
                <!-- 1. 订阅框 (保持不变) -->
                <div class="sidebar-widget newsletter-box">
                    <div style="font-weight:700; color:var(--primary-blue); text-align:center;">订阅行业日报</div>
                    <p style="font-size:0.85rem; color:#64748b; margin-bottom:10px; text-align:center;">每早8点，获取低空经济核心情报。</p>
                    <input type="email" class="newsletter-input" placeholder="输入邮箱地址">
                    <button class="btn btn-primary" style="width: 100%;">免费订阅</button>
                </div>

                <!-- 2. 政策法规更新 (JS会自动填充内容) -->
                <div class="sidebar-widget">
                    <div class="widget-title">政策法规更新</div>
                    <ul class="policy-list" id="home-policy-list">
                        <li style="color:#999; font-size:0.85rem;">加载中...</li>
                    </ul>
                </div>

                <!-- 3. 专家观点 (静态展示) -->
                <div class="sidebar-widget">
                    <div class="widget-title">专家观点</div>
                    <div class="expert-profile">
                        <div class="expert-avatar"></div> <!-- 这里稍后可以换成 <img src="..."> -->
                        <div class="expert-info">
                            <div class="expert-name">FengSong 博士</div>
                            <div class="expert-role">低空经济专家</div>
                        </div>
                    </div>
                    <p class="expert-quote">
                        "2025年将是eVTOL适航取证的关键年份，但基础设施建设仍是短板..."
                    </p>
                </div>
            </aside>
        </div>
    </div>

    <!-- 5. 公司数据库预览 -->
    <div class="standard-container">
        <div class="company-section" style="margin-bottom: 60px;">
            <div class="section-header">
                <div class="section-title">行业图谱 & 公司库</div>
                <a href="companies.html" class="section-link">浏览全部 ></a>
            </div>
            <div class="company-grid" id="home-company-container">
                <p style="text-align:center; color:#999;">正在加载公司数据...</p>
            </div>
        </div>
    </div>

     <!-- 6. Footer -->
    <footer>
        <div class="standard-container">
            <div class="footer-grid">
                <div class="footer-col brand-col">
                    <h4 style="color:white; margin-bottom:15px; font-size:1.2rem;">LowAltitude Insight</h4>
                    <p style="font-size:0.9rem; color:#94a3b8; line-height: 1.6; margin-bottom: 20px;">
                        连接政策、资本与技术，打造低空经济领域的数字化基础设施与决策引擎。
                    </p>
                    <div style="display:flex; gap:15px;">
                        <a href="#" style="width:32px; height:32px; background:#334155; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        </a>
                        <a href="#" style="width:32px; height:32px; background:#334155; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
                        </a>
                        <a href="mailto:contact@example.com" style="width:32px; height:32px; background:#334155; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        </a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4 style="color:white; margin-bottom:20px;">核心板块</h4>
                    <ul style="font-size:0.9rem; color:#94a3b8;">
                        <li style="margin-bottom:10px;"><a href="news.html" style="color:#94a3b8;">资讯快报</a></li>
                        <li style="margin-bottom:10px;"><a href="policies.html" style="color:#94a3b8;">政策法规</a></li>
                        <li style="margin-bottom:10px;"><a href="companies.html" style="color:#94a3b8;">企业数据库</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 style="color:white; margin-bottom:20px;">数据图谱</h4>
                    <ul style="font-size:0.9rem; color:#94a3b8;">
                        <li style="margin-bottom:10px;"><a href="chart-funding.html" style="color:#94a3b8;">全球融资趋势</a></li>
                        <li style="margin-bottom:10px;"><a href="chart-cities.html" style="color:#94a3b8;">试点城市分布</a></li>
                        <li style="margin-bottom:10px;"><a href="chart-companies.html" style="color:#94a3b8;">产业链全景图</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 style="color:white; margin-bottom:20px;">关于</h4>
                    <ul style="font-size:0.9rem; color:#94a3b8;">
                        <li style="margin-bottom:10px;"><a href="#" style="color:#94a3b8;">团队愿景</a></li>
                        <li style="margin-bottom:10px;"><a href="#" style="color:#94a3b8;">寻求报道</a></li>
                        <li style="margin-bottom:10px;"><a href="#" style="color:#94a3b8;">商务合作</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright" style="border-top:1px solid #334155; padding-top:20px; margin-top:40px; text-align:center; color:#64748b; font-size:0.85rem;">
                &copy; 2025 LowAltitude Insight. All rights reserved. 京ICP备XXXXXXXX号
            </div>
        </div>
    </footer>

    <!-- 7. JavaScript 逻辑 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://cpvisbzlzatfdqakqsul.supabase.co'; 
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNwdmlzYnpsemF0ZmRxYWtxc3VsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzOTgwMTYsImV4cCI6MjA3OTk3NDAxNn0.R__eoUjpzFP9_SUxIVnM9T1zpl1pcBTGMzxXLf-Orcg';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        function toggleMenu() { 
            document.getElementById('navMenu').classList.toggle('active'); 
        }

        document.addEventListener('DOMContentLoaded', async function() {
            checkUserLogin();
            loadHomeNews();
            loadHomePolicies();
            loadHomeCompanies();
            const cards = document.querySelectorAll('.data-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 100 * index);
            });
        });

        // ★★★ 修正点 2：优化新闻加载函数，添加 ID 跳转链接 ★★★
        async function loadHomeNews() {
            const { data: newsData } = await _supabase
                .from('news')
                .select('*')
                .order('publish_date', { ascending: false })
                .limit(6);

            const newsContainer = document.getElementById('home-news-container');
            if (newsData && newsData.length > 0) {
                newsContainer.innerHTML = '';
                newsData.forEach(item => {
                    const bgStyle = item.image_url 
                        ? `background: #cbd5e1 url('${item.image_url}') center/cover;` 
                        : `background: #cbd5e1;`;

                    // 核心修改：
                    // 1. 把 href="news.html" 改为 href="news-detail.html?id=${item.id}"
                    // 2. 将 class="news-image" 的 div 改为 a 标签，让图片也能点击
                    newsContainer.innerHTML += `
                        <article class="news-item">
                            <a href="news-detail.html?id=${item.id}" class="news-image" style="${bgStyle}; display:block;"></a>
                            <div class="news-content">
                                <h3><a href="news-detail.html?id=${item.id}">${item.title}</a></h3>
                                <div class="news-meta">
                                    <span class="tag">${item.category}</span>
                                    <span>${item.publish_date}</span>
                                </div>
                                <p style="font-size:0.9rem; color:#64748b; margin-top:8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${item.summary}</p>
                            </div>
                        </article>
                    `;
                });
            } else {
                newsContainer.innerHTML = '<p style="text-align:center; padding:20px;">暂无新闻</p>';
            }
        }

        // 其他函数保持不变
        async function loadHomePolicies() {
            const container = document.getElementById('home-policy-list');
            
            // ★★★ 关键修改1：必须查询 'id' 字段，否则无法跳转详情页 ★★★
            // 同时查询 title, region_type (地区), publish_date 等用于展示
            const { data } = await _supabase
                .from('policies')
                .select('id, title, region_type, department, publish_date') 
                .order('publish_date', { ascending: false })
                .limit(4); // 截图里大概只有3-4条，数量太多会很长

            if (data && data.length > 0) {
                container.innerHTML = '';
                data.forEach(item => {
                    // 处理标签显示：如果有 region_type 就显示，没有就显示 '政策'
                    // 截图中的样式是：中国·深圳 或 欧盟
                    const regionText = item.region_type || '政策动态';

                    // ★★★ 关键修改2：HTML 结构完全重写，匹配截图 ★★★
                    container.innerHTML += `
                        <li>
                            <!-- 标题：点击跳转详情页 -->
                            <a href="policy-detail.html?id=${item.id}">
                                ${item.title}
                            </a>
                            
                            <!-- 标签：灰色小块 -->
                            <span class="policy-tag">${regionText}</span>
                        </li>
                    `;
                });
            } else {
                container.innerHTML = '<li style="font-size:0.85rem; color:#999; padding:10px 0;">暂无更新</li>';
            }
        }

        async function loadHomeCompanies() {
            const { data: companyData } = await _supabase
                .from('companies')
                .select('*')
                .limit(4);
            
            const companyContainer = document.getElementById('home-company-container');
            if (companyData && companyData.length > 0) {
                companyContainer.innerHTML = '';
                companyData.forEach(item => {
                    let tagsHtml = '';
                    if (item.tags && Array.isArray(item.tags)) {
                        item.tags.slice(0, 2).forEach(tag => {
                            const activeClass = (tag === '已上市' || tag === '独角兽') ? 'highlight' : '';
                            tagsHtml += `<span class="company-tag ${activeClass}">${tag}</span>`;
                        });
                    }
                    companyContainer.innerHTML += `
                        <div class="company-card">
                            <div class="company-header">
                                <div class="company-logo-box">${item.logo_text || item.name.substring(0,2)}</div>
                                <div>
                                    <div style="font-weight:700;">${item.name}</div>
                                    <div style="font-size:0.75rem; color:#94a3b8;">${item.location}</div>
                                </div>
                            </div>
                            <p class="company-desc">${item.description}</p>
                            <div class="company-tags">${tagsHtml}</div>
                        </div>
                    `;
                });
            } else {
                companyContainer.innerHTML = '<p style="text-align:center; padding:20px;">暂无数据</p>';
            }
        }

        async function checkUserLogin() {
            const { data: { session } } = await _supabase.auth.getSession();
            const btn = document.getElementById('auth-btn');
            if (!btn) return;
            if (session) {
                const emailName = session.user.email.split('@')[0];
                btn.innerText = emailName;
                btn.style.backgroundColor = '#475569';
                btn.onclick = function() { window.location.href = 'profile.html'; };
            } else {
                btn.innerText = '订阅/登录';
                btn.onclick = function() { window.location.href = 'login.html'; };
            }
        }
    </script>
</body>
</html>